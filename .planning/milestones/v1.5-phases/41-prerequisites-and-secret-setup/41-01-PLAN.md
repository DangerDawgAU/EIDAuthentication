---
phase: 41-prerequisites-and-secret-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false
requirements: [API-01, API-02]
user_setup:
  - service: VirusTotal
    why: "Malware scanning API for build artifacts"
    env_vars:
      - name: VT_API_KEY
        source: "VirusTotal account -> Profile -> API Key"
    dashboard_config:
      - task: "Create free VirusTotal account"
        location: "https://www.virustotal.com/gui/join-us"
      - task: "Copy API key from profile"
        location: "VirusTotal Dashboard -> Profile (avatar) -> API Key"

must_haves:
  truths:
    - "VT_API_KEY secret exists in GitHub repository settings"
    - "API key is masked in workflow logs (never visible in plain text)"
    - "Secret is accessible via ${{ secrets.VT_API_KEY }} pattern"
  artifacts: []
  key_links: []
---

<objective>
Configure the VirusTotal API key as a GitHub repository secret to enable secure malware scanning in downstream phases.

Purpose: Secure credential storage enables all downstream VirusTotal scanning workflows without exposing the API key in code or logs.
Output: Documentation and verification that VT_API_KEY secret is properly configured.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Create VirusTotal Account and Obtain API Key</name>
  <files>(no files modified - manual setup)</files>
  <action>
    This is a prerequisite setup task. Claude cannot create external accounts.

    **Step 1: Create VirusTotal Account (if you don't have one)**
    1. Visit https://www.virustotal.com/gui/join-us
    2. Sign up with your email or Google account
    3. Verify your email if required

    **Step 2: Obtain Your API Key**
    1. Log in to VirusTotal
    2. Click your avatar/profile icon (top right)
    3. Navigate to your Profile or API Key section
    4. Copy your API key (it will look like a long alphanumeric string)

    **Note:** The free VirusTotal API tier provides 4 requests/minute, which is sufficient for this project's artifact scanning needs (approximately 10 artifacts per build).
  </action>
  <verify>
    Confirm you have copied a valid API key (64+ character alphanumeric string starting with a letter or number).
  </verify>
  <done>
    VirusTotal API key is available and ready to add to GitHub secrets.
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Add VT_API_KEY Secret to GitHub Repository</name>
  <files>(no files modified - manual GitHub UI configuration)</files>
  <action>
    This task adds the API key to GitHub's encrypted secrets storage.

    **Step 1: Navigate to Repository Settings**
    1. Go to https://github.com/[your-username]/EIDAuthentication
    2. Click "Settings" tab (you must have admin access)
    3. In the left sidebar, expand "Secrets and variables" then click "Actions"

    **Step 2: Create the Repository Secret**
    1. Click "New repository secret"
    2. In the "Name" field, enter exactly: `VT_API_KEY`
    3. In the "Secret" field, paste your VirusTotal API key
    4. Click "Add secret"

    **Security Notes:**
    - The secret is encrypted at rest by GitHub
    - The secret is never exposed in workflow logs (automatically masked)
    - The secret is only accessible to workflows in this repository
    - Only repository admins can view/update secrets
  </action>
  <verify>
    After adding the secret:
    1. You should see "VT_API_KEY" listed under "Repository secrets"
    2. The value should show as "Updated [date]" (not the actual key)
  </verify>
  <done>
    VT_API_KEY secret is stored in GitHub repository settings and ready for workflow use.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Secret Accessibility</name>
  <files>(no files modified - verification only)</files>
  <action>
    Claude has created a test workflow to verify the secret is accessible.

    The verification workflow will:
    1. Trigger manually via workflow_dispatch
    2. Reference the secret using `${{ secrets.VT_API_KEY }}` pattern
    3. Make a test API call to VirusTotal
    4. Report success or failure (without exposing the key)

    This confirms the secret is properly configured for Phase 42's scanning workflow.
  </action>
  <verify>
    **Manual Verification Steps:**
    1. Go to Actions tab in GitHub
    2. Find the "Verify VT API Key" workflow (will be created)
    3. Click "Run workflow" -> "Run workflow"
    4. Wait for the workflow to complete
    5. Check the workflow logs - you should see "API key verified successfully"
    6. Confirm the API key value is NOT visible in the logs (should show `***`)

    **Expected Result:**
    - Workflow completes with green checkmark
    - Logs show successful API connection
    - No API key value is visible in logs
  </verify>
  <done>
    VT_API_KEY secret is confirmed accessible and working for GitHub Actions workflows.
  </done>
</task>

</tasks>

<verification>
**Phase 41 Verification Checklist:**

1. [ ] VT_API_KEY secret exists in GitHub repository Settings -> Secrets and variables -> Actions
2. [ ] Secret value is not visible in any workflow logs (masked as `***`)
3. [ ] Test workflow successfully authenticates with VirusTotal API
4. [ ] Free API tier rate limit (4 requests/minute) is understood for Phase 42 planning

**Security Verification:**
- [ ] API key is NOT in any source file (.yml, .md, .txt, etc.)
- [ ] API key is NOT in git history
- [ ] API key is ONLY stored in GitHub Secrets
</verification>

<success_criteria>
This phase is complete when:

1. VT_API_KEY secret exists in GitHub repository settings (Settings -> Secrets and variables -> Actions)
2. A test workflow confirms the secret is accessible and the API key is valid
3. API key value is never visible in workflow logs or source code
4. Secret follows the `${{ secrets.VT_API_KEY }}` reference pattern for Phase 42
</success_criteria>

<output>
After completion, create `.planning/milestones/v1.5-phases/41-prerequisites-and-secret-setup/41-01-SUMMARY.md`

The SUMMARY should include:
- Confirmation that VT_API_KEY is configured
- Notes about VirusTotal free tier limitations (4 requests/minute)
- Ready state for Phase 42 (Basic VirusTotal Scan Job)
</output>
