---
phase: 21-sonarqube-style-issues
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - EIDCardLibrary/CredentialManagement.cpp
autonomous: true
requirements:
  - SONAR-01

must_haves:
  truths:
    - "Iterator declarations use auto when type is obvious from begin() call"
    - "Build passes with no new warnings"
  artifacts:
    - path: "EIDCardLibrary/CredentialManagement.cpp"
      provides: "Modernized iterator declarations"
      contains: "auto.*=.*\\.begin()"
  key_links:
    - from: "iterator variable"
      to: "container.begin()"
      via: "auto type deduction"
      pattern: "auto\\s+\\w+\\s*=\\s*\\w+\\.begin\\(\\)"
---

<objective>
Convert explicit iterator type declarations to `auto` in CredentialManagement.cpp where the type is obvious from the `begin()` call context.

Purpose: Improve code readability and reduce verbosity by using modern C++ `auto` for iterator declarations. The `auto` keyword is purely compile-time with zero runtime impact, making it safe for LSASS context.

Output: CredentialManagement.cpp with 6 iterator declarations modernized to use `auto`.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-sonarqube-style-issues/21-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert std::set iterator declarations to auto</name>
  <files>EIDCardLibrary/CredentialManagement.cpp</files>
  <action>
Convert the explicit `std::set<CCredential*>::iterator` declarations to `auto` at lines 112 and 139.

**Lines 112-113 (before):**
```cpp
std::set<CCredential*>::iterator iter;
for ( iter = Credentials.begin( ); iter != Credentials.end( ); iter++ )
```

**After:**
```cpp
for ( auto iter = Credentials.begin( ); iter != Credentials.end( ); iter++ )
```

**Lines 139-140 (before):**
```cpp
std::set<CCredential*>::iterator iter;
for ( iter = Credentials.begin( ); iter != Credentials.end( ); iter++ )
```

**After:**
```cpp
for ( auto iter = Credentials.begin( ); iter != Credentials.end( ); iter++ )
```

**Important:** Remove the separate iterator declaration and move it into the for-loop initializer. This follows modern C++ style and ensures the iterator is always initialized.
  </action>
  <verify>Build the EIDCardLibrary project: `msbuild EIDCardLibrary/EIDCardLibrary.vcxproj /p:Configuration=Release /p:Platform=x64`</verify>
  <done>Lines 112 and 139 use `auto iter` in the for-loop initializer with no separate declaration</done>
</task>

<task type="auto">
  <name>Task 2: Convert std::list iterator declarations to auto</name>
  <files>EIDCardLibrary/CredentialManagement.cpp</files>
  <action>
Convert the explicit `std::list<CSecurityContext*>::iterator` declarations to `auto` at lines 207 and 234.

**Lines 207-208 (before):**
```cpp
std::list<CSecurityContext*>::iterator iter;
for ( iter = Contexts.begin( ); iter != Contexts.end( ); iter++ )
```

**After:**
```cpp
for ( auto iter = Contexts.begin( ); iter != Contexts.end( ); iter++ )
```

**Lines 234-235 (before):**
```cpp
std::list<CSecurityContext*>::iterator iter;
for ( iter = Contexts.begin( ); iter != Contexts.end( ); iter++ )
```

**After:**
```cpp
for ( auto iter = Contexts.begin( ); iter != Contexts.end( ); iter++ )
```

**Important:** Same pattern as Task 1 - move declaration into for-loop initializer.
  </action>
  <verify>Build the EIDCardLibrary project and verify no new warnings</verify>
  <done>Lines 207 and 234 use `auto iter` in the for-loop initializer</done>
</task>

<task type="auto">
  <name>Task 3: Convert std::map iterator declarations to auto</name>
  <files>EIDCardLibrary/CredentialManagement.cpp</files>
  <action>
Convert the explicit `std::map<ULONG_PTR, CUsermodeContext*>::iterator` declarations to `auto` at lines 593 and 622.

**Line 593 (before):**
```cpp
std::map<ULONG_PTR, CUsermodeContext*>::iterator it = UserModeContexts.find(pHandle);
```

**After:**
```cpp
auto it = UserModeContexts.find(pHandle);
```

**Line 622 (before):**
```cpp
std::map<ULONG_PTR, CUsermodeContext*>::iterator it = UserModeContexts.find(pHandle);
```

**After:**
```cpp
auto it = UserModeContexts.find(pHandle);
```

**Note:** These are not loop iterators but find() calls. The conversion is still appropriate because the type is obvious from the `find()` call on the `UserModeContexts` map.
  </action>
  <verify>Build the EIDCardLibrary project and verify no new warnings</verify>
  <done>Lines 593 and 622 use `auto it` for map::find() results</done>
</task>

</tasks>

<verification>
1. Build EIDCardLibrary project succeeds with zero errors
2. No new compiler warnings introduced
3. Grep for remaining explicit iterator declarations:
   - `grep -n "std::set<.*>::iterator" EIDCardLibrary/CredentialManagement.cpp` should return no matches in function bodies
   - `grep -n "std::list<.*>::iterator" EIDCardLibrary/CredentialManagement.cpp` should return no matches in function bodies
   - `grep -n "std::map<.*>::iterator" EIDCardLibrary/CredentialManagement.cpp` should return no matches in function bodies
4. Grep for new auto usage confirms changes:
   - `grep -n "auto.*=.*\\.begin()" EIDCardLibrary/CredentialManagement.cpp` should show 4 matches
   - `grep -n "auto.*=.*\\.find()" EIDCardLibrary/CredentialManagement.cpp` should show 2 matches
</verification>

<success_criteria>
- All 6 iterator declarations in CredentialManagement.cpp converted to `auto`
- Build passes with no new warnings
- No explicit STL iterator type declarations remain in function bodies
</success_criteria>

<output>
After completion, create `.planning/phases/21-sonarqube-style-issues/21-01-SUMMARY.md`
</output>
