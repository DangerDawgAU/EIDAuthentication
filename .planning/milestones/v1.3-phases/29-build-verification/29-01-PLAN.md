---
phase: 29-build-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
requirements: [VER-01]

must_haves:
  truths:
    - "All 7 projects compile with zero errors"
    - "No new compiler warnings introduced by v1.3 changes"
    - "All required DLLs, EXEs, and LIBs are present"
    - "Static CRT linkage verified for LSASS-loaded components"
  artifacts:
    - path: "x64/Release/EIDAuthenticationPackage.dll"
      provides: "LSA Authentication Package binary"
    - path: "x64/Release/EIDCredentialProvider.dll"
      provides: "Credential Provider binary"
    - path: "x64/Release/EIDConfigurationWizard.exe"
      provides: "Configuration Wizard GUI"
    - path: "x64/Release/EIDConfigurationWizardElevated.exe"
      provides: "Elevated helper for admin tasks"
    - path: "x64/Release/EIDLogManager.exe"
      provides: "Event tracing diagnostic tool"
    - path: "x64/Release/EIDPasswordChangeNotification.dll"
      provides: "Password change notification DLL"
    - path: "x64/Release/EIDCardLibrary.lib"
      provides: "Shared library static archive"
  key_links:
    - from: "build.bat"
      to: "x64/Release/*.dll"
      via: "MSBuild solution build"
      pattern: "msbuild.*Release\\|x64"
---

<objective>
Final build verification for v1.3 Deep Modernization milestone.

Purpose: Confirm all cumulative changes from Phases 21-28 compile successfully and produce valid binaries. This is the final gate before SonarQube verification in Phase 30.

Output: Verified Release x64 binaries for all 7 projects, confirming v1.3 stability.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-diagnostics-logging/28-05-SUMMARY.md

# v1.3 Changes (Phases 21-28)
Phase 21: Replaced explicit types with auto where clearer (iterator declarations)
Phase 22: Converted macros to const/constexpr where safe
Phase 23: Verified global variable const categories
Phase 24: Reduced nesting depth with early returns and extracted handlers
Phase 25: Extracted helper functions from high-complexity code
Phase 26: Verified 1.9% duplication rate (below threshold)
Phase 27: Documented C++23 feature deferrals (modules, flat containers, stacktrace)
Phase 28: Enhanced diagnostics with EIDLogErrorWithContext, EIDLogStackTrace, security audit prefixes

# Projects to Verify
1. EIDCardLibrary (static library) - Foundation, all other projects depend on this
2. EIDAuthenticationPackage (LSA DLL) - Core authentication logic
3. EIDCredentialProvider (Credential Provider v2 DLL) - Login screen UI
4. EIDConfigurationWizard (Win32 EXE) - User configuration GUI
5. EIDConfigurationWizardElevated (Win32 EXE) - UAC elevation helper
6. EIDLogManager (Win32 EXE) - Diagnostic tool
7. EIDPasswordChangeNotification (Password Filter DLL) - Password sync

# Key Constraints
- LSASS context: No exceptions, no console I/O, static CRT required
- Windows 7 support: Must use v143 toolset
- C++23 flag: Use /std:c++23preview
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean rebuild of all 7 projects in Release x64 configuration</name>
  <files>build.bat, EIDCredentialProvider.sln</files>
  <action>
Perform a clean rebuild to ensure all v1.3 changes compile correctly:

```bash
cd "C:/Users/user/Documents/EIDAuthentication"
# Clean previous build artifacts
rm -rf x64/Release/*.dll x64/Release/*.exe x64/Release/*.lib x64/Release/*.pdb 2>/dev/null || true
# Build all projects
./build.bat Release x64
```

Capture the full build output. The build must:
1. Use /std:c++23preview (LanguageStandard=stdcpp23 in vcxproj)
2. Use static CRT (/MT) for Release configuration
3. Compile all 7 projects with zero errors

Count total warnings and compare against Phase 28 baseline (0 new warnings expected).
  </action>
  <verify>
Build returns exit code 0 (success). All 7 projects appear in build output with "Build succeeded".
  </verify>
  <done>All 7 projects rebuild successfully with zero compilation errors.</done>
</task>

<task type="auto">
  <name>Task 2: Verify all required build artifacts are present</name>
  <files>x64/Release/*.dll, x64/Release/*.exe, x64/Release/*.lib</files>
  <action>
Verify the following files exist in x64/Release/ directory:

Required DLLs (3):
- EIDAuthenticationPackage.dll (LSA Authentication Package)
- EIDCredentialProvider.dll (Credential Provider v2)
- EIDPasswordChangeNotification.dll (Password Filter)

Required EXEs (3):
- EIDConfigurationWizard.exe (Configuration GUI)
- EIDConfigurationWizardElevated.exe (Elevated helper)
- EIDLogManager.exe (Diagnostic tool)

Required Libraries (1):
- EIDCardLibrary.lib (Static library)

```bash
ls -la "C:/Users/user/Documents/EIDAuthentication/x64/Release/" | grep -E "^-.*EID"
```

Count should show at least 7 EID* files.
  </action>
  <verify>
All 7 build artifacts (3 DLLs, 3 EXEs, 1 LIB) are present with non-zero file sizes.
  </verify>
  <done>All 7 required binaries present in x64/Release/ directory.</done>
</task>

<task type="auto">
  <name>Task 3: Verify static CRT linkage for LSASS-loaded components</name>
  <files>x64/Release/EIDAuthenticationPackage.dll, x64/Release/EIDPasswordChangeNotification.dll</files>
  <action>
Verify static CRT linkage in the two LSASS-loaded DLLs using dumpbin:

```bash
# Find Visual Studio dumpbin
DUMPBIN=$(find "/c/Program Files/Microsoft Visual Studio" -name "dumpbin.exe" 2>/dev/null | head -1)

# Check EIDAuthenticationPackage.dll
"$DUMPBIN" /DEPENDENTS x64/Release/EIDAuthenticationPackage.dll 2>/dev/null | grep -i "msvc\|vcruntime" && echo "DYNAMIC CRT DETECTED" || echo "Static CRT OK"

# Check EIDPasswordChangeNotification.dll
"$DUMPBIN" /DEPENDENTS x64/Release/EIDPasswordChangeNotification.dll 2>/dev/null | grep -i "msvc\|vcruntime" && echo "DYNAMIC CRT DETECTED" || echo "Static CRT OK"
```

Static CRT binaries should NOT list MSVCR*.dll or vcruntime*.dll in dependencies.
  </action>
  <verify>
dumpbin output shows no MSVCR* or vcruntime* dependencies for LSASS-loaded DLLs.
  </verify>
  <done>Static CRT linkage confirmed for EIDAuthenticationPackage.dll and EIDPasswordChangeNotification.dll.</done>
</task>

<task type="auto">
  <name>Task 4: Check for new compiler warnings</name>
  <files>build output</files>
  <action>
Analyze the build output for compiler warnings. Compare against known baseline from Phase 28.

Expected acceptable warnings (pre-existing):
- C4701: Potentially uninitialized local variable (StoredCredentialManagement.cpp, CContainer.cpp)
- Windows SDK header macro redefinitions (ntstatus.h)

Check for any NEW warnings introduced by v1.3 changes:

```bash
cd "C:/Users/user/Documents/EIDAuthentication"
./build.bat Release x64 2>&1 | grep -i "warning" | grep -v "ntstatus.h" | sort | uniq -c
```

Document any warnings that appear to be new compared to Phase 28 baseline.
  </action>
  <verify>
Warning count is stable. No new warnings introduced by Phases 21-28 changes.
  </verify>
  <done>Warning analysis complete. No new v1.3 warnings introduced.</done>
</task>

</tasks>

<verification>
Phase 29 verification criteria:

1. **Build Success**: All 7 projects compile with exit code 0
2. **Artifact Completeness**: All 3 DLLs, 3 EXEs, 1 LIB present in x64/Release/
3. **CRT Linkage**: Static CRT (/MT) verified in LSASS-loaded DLLs
4. **Warning Stability**: No new compiler warnings introduced by v1.3 changes
</verification>

<success_criteria>
1. All 7 projects compile with zero errors
2. No new warnings introduced compared to Phase 28 baseline
3. All required binaries present (3 DLLs, 3 EXEs, 1 LIB)
4. Static CRT linkage confirmed for LSASS-loaded components
5. v1.3 build verification summary created for Phase 30 readiness
</success_criteria>

<output>
After completion, create `.planning/phases/29-build-verification/29-01-SUMMARY.md` with:
- Build results (success/failure status)
- List of all generated artifacts with file sizes
- CRT linkage verification results
- Compiler warning analysis (baseline comparison)
- Phase 30 readiness assessment
</output>
