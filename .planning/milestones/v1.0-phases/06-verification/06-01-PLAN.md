---
phase: 06-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [build.bat, EIDAuthentication.sln]
autonomous: true

must_haves:
  truths:
    - "All 7 projects build successfully with C++23 (/std:c++23preview)"
    - "Build produces all required DLLs and EXEs"
    - "Static CRT linkage (/MT) verified in Release builds"
    - "No new C++23 compiler warnings introduced"
  artifacts:
    - path: "x64/Release/EIDAuthenticationPackage.dll"
      provides: "LSA Authentication Package binary"
    - path: "x64/Release/EIDCredentialProvider.dll"
      provides: "Credential Provider binary"
    - path: "x64/Release/EIDConfigurationWizard.exe"
      provides: "Configuration Wizard GUI"
    - path: "x64/Release/EIDConfigurationWizardElevated.exe"
      provides: "Elevated helper for admin tasks"
    - path: "x64/Release/EIDLogManager.exe"
      provides: "Event tracing diagnostic tool"
    - path: "x64/Release/EIDPasswordChangeNotification.dll"
      provides: "Password change notification DLL"
    - path: "x64/Release/EIDCardLibrary.lib"
      provides: "Shared library static archive"
  key_links:
    - from: "build.bat"
      to: "x64/Release/*.dll"
      via: "MSBuild solution build"
      pattern: "msbuild.*Release\\|x64"
    - from: "*.vcxproj"
      to: "compiler output"
      via: "LanguageStandard=stdcpp23"
      pattern: "LanguageStandard.*stdcpp23"
---

<objective>
Build all 7 projects with C++23 and verify build artifacts are complete and correctly linked.

Purpose: Ensure the C++23 modernization produces valid, deployable binaries across all components before proceeding to functional testing. This automated verification catches build regressions before human testing begins.

Output: Complete set of Release x64 binaries for all 7 projects, with static CRT linkage confirmed.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-build-system/01-03-SUMMARY.md

# C++23 Configuration (from Phase 1)
All 7 projects have LanguageStandard=stdcpp23 configured in all 4 configurations (Debug|Win32, Debug|x64, Release|Win32, Release|x64).

# Known Blocker
EIDCardLibrary references cardmod.h which is not in the standard Windows SDK. This header is part of the Smart Card Credential Provider SDK (CPDK). This may cause build failures in EIDCardLibrary and dependent projects.

# Projects to Build
1. EIDCardLibrary (static library) - Foundation, all other projects depend on this
2. EIDAuthenticationPackage (LSA DLL) - Core authentication logic
3. EIDCredentialProvider (Credential Provider v2 DLL) - Login screen UI
4. EIDConfigurationWizard (Win32 EXE) - User configuration GUI
5. EIDConfigurationWizardElevated (Win32 EXE) - UAC elevation helper
6. EIDLogManager (Win32 EXE) - Diagnostic tool
7. EIDPasswordChangeNotification (Password Filter DLL) - Password sync
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Release x64 configuration for all projects</name>
  <files>build.bat, EIDAuthentication.sln</files>
  <action>
Run the build script to compile all 7 projects in Release x64 configuration:

```bash
cd "C:/Users/user/Documents/EIDAuthentication"
./build.bat Release x64
```

This will invoke MSBuild with the solution file. The build script should:
1. Use the correct Visual Studio version (VS 2022)
2. Build with /std:c++23preview (from LanguageStandard=stdcpp23)
3. Use static CRT (/MT) for Release configuration

Capture the full build output to analyze any errors or warnings.
  </action>
  <verify>
Build returns exit code 0 (success). Check for output in x64/Release/ directory.
  </verify>
  <done>All 7 projects build successfully with zero errors. Build artifacts exist in x64/Release/.</done>
</task>

<task type="auto">
  <name>Task 2: Verify all required build artifacts are present</name>
  <files>x64/Release/*.dll, x64/Release/*.exe, x64/Release/*.lib</files>
  <action>
Verify the following files exist in x64/Release/ directory:

Required DLLs:
- EIDAuthenticationPackage.dll (LSA Authentication Package)
- EIDCredentialProvider.dll (Credential Provider v2)
- EIDPasswordChangeNotification.dll (Password Filter)

Required EXEs:
- EIDConfigurationWizard.exe (Configuration GUI)
- EIDConfigurationWizardElevated.exe (Elevated helper)
- EIDLogManager.exe (Diagnostic tool)

Required Libraries:
- EIDCardLibrary.lib (Static library)

List all files in x64/Release/ and confirm presence of all 7 artifacts.
  </action>
  <verify>
```bash
ls -la "C:/Users/user/Documents/EIDAuthentication/x64/Release/" | grep -E "(EIDAuthenticationPackage|EIDCredentialProvider|EIDConfigurationWizard|EIDLogManager|EIDPasswordChangeNotification|EIDCardLibrary)"
```
Count should show at least 7 EID* files (3 DLLs + 3 EXEs + 1 LIB, plus import libs).
  </verify>
  <done>All 7 build artifacts (3 DLLs, 3 EXEs, 1 LIB) are present in x64/Release/ directory.</done>
</task>

<task type="auto">
  <name>Task 3: Verify static CRT linkage in Release builds</name>
  <files>x64/Release/*.dll, x64/Release/*.exe</files>
  <action>
Use dumpbin.exe (part of Visual Studio) to verify static CRT linkage in Release builds. Static CRT (/MT) is required for LSASS-loaded DLLs to avoid dependency issues.

For each DLL and EXE in x64/Release/, check the runtime library dependency:

```bash
# Use dumpbin to check dependencies
"C:/Program Files/Microsoft Visual Studio/2022/Community/VC/Tools/MSVC/14.44.34434/bin/Hostx64/x64/dumpbin.exe" /DEPENDENTS x64/Release/EIDAuthenticationPackage.dll
```

Look for absence of MSVCR*.dll dependencies. Static CRT binaries should NOT depend on MSVCR140.dll, MSVCR140d.dll, vcruntime140.dll, etc.

Verify at minimum:
- EIDAuthenticationPackage.dll (CRITICAL - loads into LSASS)
- EIDCredentialProvider.dll (loads into Winlogon)
- EIDPasswordChangeNotification.dll (loads into LSASS)
  </action>
  <verify>
dumpbin output shows no dependency on MSVCR*.dll or vcruntime*.dll files for the three LSASS/Winlogon-loaded DLLs.
  </verify>
  <done>All DLLs and EXEs show static CRT linkage (no MSVCR* dependencies). LSASS-loaded components verified.</done>
</task>

<task type="auto">
  <name>Task 4: Verify no new C++23 compiler warnings</name>
  <files>build output log</files>
  <action>
Analyze the build output for any C++23-specific warnings that might indicate code issues. Common C++23 warnings to check:
- C4996: Deprecated function usage (std::transform, etc.)
- C5053: Use of deprecated enum features
- C5054: Operator '&' on enum type is deprecated
- Any warnings introduced by /std:c++23preview

Compare against known acceptable warnings from Phase 1 (C4701 potentially uninitialized locals in StoredCredentialManagement.cpp, CContainer.cpp).

Run a grep search for C++23-related warnings in the build output:
```bash
cd "C:/Users/user/Documents/EIDAuthentication"
./build.bat Release x64 2>&1 | grep -E "warning C[45][0-9]{3}" | sort | uniq -c
```

Document any new warnings that appear.
  </action>
  <verify>
Build shows no new C++23-specific warnings beyond the known C4701 warnings documented in Phase 1.
  </verify>
  <done>Build warning count is stable. No new C++23 warnings introduced by the modernization.</done>
</task>

</tasks>

<verification>
Overall verification for 06-01 (Build Artifact Verification):

1. **Build Success**: All 7 projects compile with exit code 0
2. **Artifact Completeness**: All 3 DLLs, 3 EXEs, 1 LIB present in x64/Release/
3. **CRT Linkage**: Static CRT (/MT) verified in LSASS-loaded DLLs via dumpbin
4. **Warning Stability**: No new C++23 compiler warnings introduced

If build fails due to missing cardmod.h:
- Document the specific error
- Note which projects fail (likely EIDCardLibrary and dependents)
- This is a pre-existing blocker, not a C++23 regression
</verification>

<success_criteria>
1. Clean build of all 7 projects completes successfully
2. All required binaries (3 DLLs, 3 EXEs, 1 LIB) present in x64/Release/
3. Static CRT linkage confirmed in LSASS-loaded components
4. No new C++23 compiler warnings introduced
5. Build verification summary created for next phase

**Known limitation**: If cardmod.h is missing, EIDCardLibrary and dependent projects may not build. This is a pre-existing SDK dependency issue, not a C++23 regression.
</success_criteria>

<output>
After completion, create `.planning/phases/06-verification/06-01-SUMMARY.md` with:
- Build results (success/failure status per project)
- List of all generated artifacts with sizes and timestamps
- CRT linkage verification results
- Compiler warning summary
- Any build blockers identified (e.g., cardmod.h)
</output>
