---
phase: 24-sonarqube-nesting-issues
plan: 03
type: execute
wave: 2
depends_on:
  - 24-01
  - 24-02
files_modified: []
autonomous: true
requirements:
  - SONAR-04
user_setup: []

must_haves:
  truths:
    - "All 7 projects build successfully"
    - "Won't-fix nesting categories documented"
    - "Phase complete with verification of changes"
  artifacts:
    - path: ".planning/phases/24-sonarqube-nesting-issues/24-03-SUMMARY.md"
      provides: "Phase 24 completion summary with won't-fix documentation"
      contains: "Won't-Fix"
  key_links:
    - from: "Build verification"
      to: "All projects"
      via: "msbuild"
      pattern: "0 Error.*0 Warning"
---

<objective>
Verify all Phase 24 changes compile successfully and document won't-fix nesting categories.

Purpose: Ensure all refactoring is verified through full solution build, and document the nesting issues that should remain unchanged due to risk or architectural constraints.

Output: Build verification results and won't-fix documentation.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-sonarqube-nesting-issues/24-RESEARCH.md

@.planning/phases/24-sonarqube-nesting-issues/24-01-SUMMARY.md
@.planning/phases/24-sonarqube-nesting-issues/24-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build verification for all projects</name>
  <files></files>
  <action>
Execute full solution build to verify all Phase 24 changes compile without errors:

1. Navigate to solution directory
2. Build entire solution in Release x64 configuration:
   ```
   msbuild EIDAuthentication.sln /p:Configuration=Release /p:Platform=x64 /t:Rebuild /m
   ```

3. Verify build output:
   - 0 Errors
   - No new warnings introduced by Phase 24 changes

4. If build fails:
   - Review error messages
   - Fix compilation issues in modified files
   - Re-run build until successful
  </action>
  <verify>
Build command completes with exit code 0 and output shows "0 Error(s)"
  </verify>
  <done>
All 7 projects build successfully with zero errors and no new warnings from Phase 24 changes.
</done>
</task>

<task type="auto">
  <name>Task 2: Document won't-fix nesting categories</name>
  <files>.planning/phases/24-sonarqube-nesting-issues/24-03-SUMMARY.md</files>
  <action>
Create documentation for nesting issues that should remain unchanged (won't-fix). Based on RESEARCH.md, document these categories:

## Won't-Fix Categories for Nesting Depth

### Category 1: SEH-Protected Code (Won't-Fix)
**Files affected:** EIDAuthenticationPackage.cpp, most LSA entry points
**Reason:** Functions using `__try/__except` for exception handling require specific block structure. Refactoring risks breaking exception safety in security-critical LSASS code.
**Estimated issues:** ~5 issues
**Risk level:** High

### Category 2: Complex State Machines (Won't-Fix)
**Files affected:** CSmartCardNotifier.cpp (GetReaderStates function)
**Reason:** Multi-way conditional logic with many interrelated branches. Flattening would require large function count increase, harming readability rather than improving it.
**Estimated issues:** ~8 issues
**Risk level:** Medium

### Category 3: Cryptographic Validation Chains (Won't-Fix)
**Files affected:** CertificateUtilities.cpp (CreateCertificate, ImportFileToSmartCard)
**Reason:** Nested certificate validation and key operations are security-relevant. Explicit sequential validation flow is intentional. Guard clauses might obscure the security-critical flow.
**Estimated issues:** ~15 issues
**Risk level:** High

### Category 4: Windows Message Handlers (Partial Won't-Fix)
**Files affected:** EIDConfigurationWizard dialog procedures (remaining WM_COMMAND cases)
**Reason:** Deep switch-case nesting in window procedures is idiomatic Windows programming. Some flattening was done (option handlers), but message dispatch structure should remain standard.
**Estimated issues:** ~5 issues
**Risk level:** Low (idiomatic pattern)

### Summary
- **Fixed this phase:** ~25 issues (WndProc_03NEW option handlers, WaitForSmartCardInsertion continue pattern, SelectFirstCertificateWithPrivateKey continue pattern)
- **Won't-Fix documented:** ~33 issues (SEH code, state machines, crypto validation, message handlers)
- **Total ~52 issues accounted for**
  </action>
  <verify>
Documentation file exists with all won't-fix categories listed with justifications.
  </verify>
  <done>
Won't-fix documentation created with 4 categories and estimated issue counts totaling ~33 remaining issues with justifications.
</done>
</task>

<task type="auto">
  <name>Task 3: Create Phase 24 completion summary</name>
  <files>.planning/phases/24-sonarqube-nesting-issues/24-03-SUMMARY.md</files>
  <action>
Create the phase completion summary documenting:

1. Files modified in Phase 24
2. Nesting issues fixed (with specific functions and techniques used)
3. Won't-fix categories with justifications
4. Build verification results
5. Remaining work (if any)

Summary should follow standard format from templates/summary.md.
  </action>
  <verify>
Summary file exists with all required sections.
  </verify>
  <done>
Phase 24 summary created documenting all changes, won't-fix categories, and verification results.
</done>
</task>

</tasks>

<verification>
1. Full solution build passes with 0 errors
2. Won't-fix documentation created with 4 categories
3. Phase summary created
4. All Phase 24 plans executed successfully
</verification>

<success_criteria>
- All 7 projects compile with zero errors
- Nesting issues reduced by ~25 issues (documented with specific techniques)
- Won't-fix categories documented with justifications (~33 issues)
- Phase summary documents all changes and outcomes
- Build passes confirm functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/24-sonarqube-nesting-issues/24-03-SUMMARY.md`
</output>
