---
phase: 27-cpp23-advanced-features
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/27-cpp23-advanced-features/27-DEFERRAL.md
autonomous: true
requirements:
  - CPP23-01
  - CPP23-02
  - CPP23-03

must_haves:
  truths:
    - "All three C++23 features (modules, flat containers, stacktrace) are documented as deferred with justification"
    - "Research findings are preserved in a consumable summary format"
    - "Phase 28 can proceed with alternative approaches (CaptureStackBackTrace)"
  artifacts:
    - path: ".planning/phases/27-cpp23-advanced-features/27-DEFERRAL.md"
      provides: "Formal documentation of deferred C++23 features with justification"
      contains: "CPP23-01, CPP23-02, CPP23-03"
  key_links: []
---

<objective>
Document C++23 advanced features deferral decisions with full justification.

Purpose: Formally record why C++23 modules, flat containers, and stacktrace cannot be adopted in this milestone, preserving research findings and enabling Phase 28 to proceed with alternatives.

Output: 27-DEFERRAL.md documenting deferred requirements with MSVC status and alternatives.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-cpp23-advanced-features/27-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create C++23 Deferral Documentation</name>
  <files>.planning/phases/27-cpp23-advanced-features/27-DEFERRAL.md</files>
  <action>
Create a formal deferral document that records the research findings and justifies deferral for all three C++23 advanced features.

The document MUST include:

## Section 1: Deferral Summary
- Table with columns: Requirement ID, Feature, MSVC Status, Decision, Alternative
- Row for CPP23-01 (import std; modules): Won't-fix - Partial support, immature tooling, CMake experimental - Defer to future milestone
- Row for CPP23-02 (std::flat_map/flat_set): Won't-fix - NOT IMPLEMENTED in MSVC (only GCC 15+/Clang 20+) - Defer until MSVC implements
- Row for CPP23-03 (std::stacktrace): Won't-fix - Partial/buggy in MSVC 19.34+ - Use CaptureStackBackTrace Win32 API in Phase 28

## Section 2: Detailed Justifications

### CPP23-01: C++23 Modules (import std;)
- MSVC Status: Partial support in 19.35+, marked "partial" in cppreference
- CMake Status: Experimental in 3.28+, still evolving
- Conformance: Incomplete, not production-ready
- Risk Assessment: Build system instability outweighs build time benefits
- Decision: Defer until MSVC conformance is complete and CMake support is non-experimental

### CPP23-02: Flat Containers (std::flat_map, std::flat_set)
- MSVC Status: NOT IMPLEMENTED (cppreference shows empty MSVC column)
- GCC/Clang: GCC 15+ and Clang 20+ have implementations
- Timeline: No Microsoft implementation announcement
- Current State: Continue using std::map/std::set (perform adequately)
- Decision: Defer until MSVC implements; no custom replacement

### CPP23-03: Stack Trace (std::stacktrace)
- MSVC Status: Partial in 19.34+, known bugs with Windows symbol handling
- Reliability: Produces corrupted/empty traces in some scenarios
- LSASS Impact: Unreliable in security-critical context
- Alternative: CaptureStackBackTrace Win32 API with SymFromAddr for symbol resolution
- Decision: Won't-fix for std::stacktrace; Phase 28 will implement CaptureStackBackTrace

## Section 3: Phase 28 Recommendations
- Document that Phase 28 (Diagnostics) can proceed with:
  - CaptureStackBackTrace for stack traces
  - OutputDebugString/ETW for structured logging
  - Existing std::expected and std::format (non-LSASS code)
  - Traditional #include headers

## Section 4: Re-evaluation Triggers
- MSVC announces flat container implementation
- std::stacktrace bugs resolved in MSVC
- CMake module support becomes non-experimental
- VS 2027 or later major version release

Include frontmatter with:
- phase: 27-cpp23-advanced-features
- document_type: deferral
- created: 2026-02-18
- requirements: CPP23-01, CPP23-02, CPP23-03
- decision: deferred
- milestone_target: future (post-v1.3)
  </action>
  <verify>
    1. File exists at .planning/phases/27-cpp23-advanced-features/27-DEFERRAL.md
    2. File contains "CPP23-01", "CPP23-02", "CPP23-03"
    3. File contains "Won't-fix" or "deferred" decision for all three
    4. File contains "CaptureStackBackTrace" as alternative for CPP23-03
  </verify>
  <done>
    - 27-DEFERRAL.md created with deferral justifications for all three C++23 features
    - Research findings preserved in structured format
    - Phase 28 recommendations documented
  </done>
</task>

</tasks>

<verification>
1. 27-DEFERRAL.md exists and contains all three requirement IDs
2. Each requirement has clear Won't-fix/deferred decision with MSVC status
3. Alternative approaches documented for Phase 28
4. File is properly formatted markdown with frontmatter
</verification>

<success_criteria>
1. CPP23-01 modules feasibility documented with MSVC compatibility notes
2. CPP23-02 flat_map/flat_set status documented as not implemented in MSVC
3. CPP23-03 stacktrace status documented with CaptureStackBackTrace alternative
4. Phase 28 has clear path forward without std::stacktrace dependency
</success_criteria>

<output>
After completion, create `.planning/phases/27-cpp23-advanced-features/27-01-SUMMARY.md`
</output>
