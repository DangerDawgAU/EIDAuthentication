---
phase: 03-compile-time-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - EIDCardLibrary/EIDCardLibrary.h
  - EIDCardLibrary/StoredCredentialManagement.h
  - EIDCardLibrary/GPO.h
  - EIDCredentialProvider/common.h
  - EIDCredentialProvider/CMessageCredential.h
  - EIDConfigurationWizard/CContainerHolder.h
autonomous: true

must_haves:
  truths:
    - "Enum to integer conversions use std::to_underlying() instead of static_cast"
    - "All 14 enum definitions are accessible via std::to_underlying() where needed"
    - "Code compiles without errors after std::to_underlying() changes"
    - "<utility> header is included in all files using std::to_underlying()"
  artifacts:
    - path: "EIDCardLibrary/EIDCardLibrary.h"
      provides: "7 enum definitions with std::to_underlying() support"
      contains: "#include <utility>"
    - path: "EIDCardLibrary/StoredCredentialManagement.h"
      provides: "EID_PRIVATE_DATA_TYPE enum with std::to_underlying() support"
      contains: "#include <utility>"
    - path: "EIDCardLibrary/GPO.h"
      provides: "GPOPolicy enum with std::to_underlying() support"
      contains: "#include <utility>"
    - path: "EIDCredentialProvider/common.h"
      provides: "2 field ID enums with std::to_underlying() support"
      contains: "#include <utility>"
    - path: "EIDCredentialProvider/CMessageCredential.h"
      provides: "CMessageCredentialStatus enum with std::to_underlying() support"
      contains: "#include <utility>"
    - path: "EIDConfigurationWizard/CContainerHolder.h"
      provides: "CheckType enum with std::to_underlying() support"
      contains: "#include <utility>"
  key_links:
    - from: "EIDCardLibrary/EIDCardLibrary.h"
      to: "std::to_underlying"
      via: "#include <utility>"
      pattern: "#include <utility>"
    - from: "Any file using enum conversion"
      to: "std::to_underlying()"
      via: "Function call instead of static_cast"
      pattern: "std::to_underlying\\s*\\("
---

<objective>
Replace unsafe enum-to-integer conversions with type-safe `std::to_underlying()` across all 14 enum definitions in the codebase.

Purpose: Eliminate verbose static_cast patterns and improve type safety when converting enums to their underlying types. The research confirmed this is a library-only feature (VS 2022 17.0+) with no special compile flags required.

Output: All enum definitions accessible via std::to_underlying() with <utility> header included where needed.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-compile-time-enhancements/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add <utility> header and apply std::to_underlying to EIDCardLibrary enums</name>
  <files>EIDCardLibrary/EIDCardLibrary.h, EIDCardLibrary/StoredCredentialManagement.h, EIDCardLibrary/GPO.h</files>
  <action>
    For each of the 9 enum definitions in EIDCardLibrary headers:

    1. EIDCardLibrary.h (7 enums at lines 61, 85, 132, 140, 245, 254, 265):
       - EID_INTERACTIVE_LOGON_SUBMIT_TYPE
       - EID_PROFILE_BUFFER_TYPE
       - EID_CREDENTIAL_PROVIDER_READER_STATE
       - EID_CALLPACKAGE_MESSAGE
       - EID_MESSAGE_STATE
       - EID_MESSAGE_TYPE
       - EID_SSP_CALLER

    2. StoredCredentialManagement.h (1 enum at line 23):
       - EID_PRIVATE_DATA_TYPE

    3. GPO.h (1 enum at line 23):
       - GPOPolicy

    Add `#include <utility>` at the top of each file (after existing includes, before guard if needed).

    Note: This task only ADDS the header include. The actual conversion usage will be addressed when those casts are encountered in the codebase. The research showed that existing enum casts in this codebase use simple `static_cast<int>` (not verbose underlying_type_t patterns), so the primary value is having <utility> available for future conversions.

    Do NOT modify existing enum definitions themselves - they are compatible with std::to_underlying as-is.
  </action>
  <verify>grep -n "#include <utility>" EIDCardLibrary/EIDCardLibrary.h EIDCardLibrary/StoredCredentialManagement.h EIDCardLibrary/GPO.h</verify>
  <done>All three EIDCardLibrary headers include <utility> header for std::to_underlying support</done>
</task>

<task type="auto">
  <name>Task 2: Add <utility> header to EIDCredentialProvider enums</name>
  <files>EIDCredentialProvider/common.h, EIDCredentialProvider/CMessageCredential.h</files>
  <action>
    For the 3 enum definitions in EIDCredentialProvider headers:

    1. common.h (2 enums at lines 35, 47):
       - SAMPLE_FIELD_ID
       - SAMPLE_MESSAGE_FIELD_ID

    2. CMessageCredential.h (1 enum at line 32):
       - CMessageCredentialStatus

    Add `#include <utility>` at the top of each file (after existing includes).

    Do NOT modify existing enum definitions - they are compatible with std::to_underlying as-is.
  </action>
  <verify>grep -n "#include <utility>" EIDCredentialProvider/common.h EIDCredentialProvider/CMessageCredential.h</verify>
  <done>All EIDCredentialProvider headers include <utility> header for std::to_underlying support</done>
</task>

<task type="auto">
  <name>Task 3: Add <utility> header to EIDConfigurationWizard enums</name>
  <files>EIDConfigurationWizard/CContainerHolder.h</files>
  <action>
    For the 1 enum definition in EIDConfigurationWizard headers:

    1. CContainerHolder.h (1 enum at line 26):
       - CheckType

    Add `#include <utility>` at the top of the file (after existing includes).

    Do NOT modify existing enum definitions - they are compatible with std::to_underlying as-is.
  </action>
  <verify>grep -n "#include <utility>" EIDConfigurationWizard/CContainerHolder.h</verify>
  <done>EIDConfigurationWizard header includes <utility> header for std::to_underlying support</done>
</task>

<task type="auto">
  <name>Task 4: Verify build succeeds with <utility> headers added</name>
  <files>EIDCardLibrary.vcxproj</files>
  <action>
    Build EIDCardLibrary project to verify that adding <utility> headers does not introduce any compile errors.

    Command: msbuild EIDCardLibrary/EIDCardLibrary.vcxproj /p:Configuration=Debug /p:Platform=x64 /t:ClCompile

    Expect: Build succeeds with no new errors (the existing code should compile unchanged - we only added headers).

    If build fails: Investigate the error - it should not be related to <utility> header as this is a standard C++23 library header.
  </action>
  <verify>msbuild EIDCardLibrary/EIDCardLibrary.vcxproj /p:Configuration=Debug /p:Platform=x64 /t:ClCompile 2>&1 | tail -20</verify>
  <done>Build succeeds without errors after adding <utility> headers to all enum-containing files</done>
</task>

</tasks>

<verification>
Overall phase verification:

1. All 6 header files now include <utility> for std::to_underlying support
2. EIDCardLibrary builds successfully with no new errors
3. grep confirms 6 occurrences of "#include <utility>" across the modified files
4. No existing enum definitions were modified (they work with std::to_underlying as-is)
</verification>

<success_criteria>
1. <utility> header included in all 6 files containing enum definitions
2. Build succeeds without errors
3. std::to_underlying() is available for use with all 14 enum types
4. No regression in existing code behavior
</success_criteria>

<output>
After completion, create `.planning/phases/03-compile-time-enhancements/03-01-SUMMARY.md`
</output>
