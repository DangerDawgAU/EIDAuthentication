---
phase: 04-code-quality
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - EIDConfigurationWizard/CContainerHolder.cpp
autonomous: true
user_setup: []

must_haves:
  truths:
    - "swprintf_s replaced with std::format in EIDConfigurationWizard"
    - "std::format is NOT used in any LSASS components (EIDCardLibrary, EIDCredentialProvider, EIDNativeLogon, EIDPasswdChangeNotification)"
    - "Code compiles successfully with C++23 after changes"
  artifacts:
    - path: "EIDConfigurationWizard/CContainerHolder.cpp"
      provides: "std::format usage for error message formatting"
      contains: "#include <format>"
  key_links:
    - from: "EIDConfigurationWizard/CContainerHolder.cpp"
      to: "std::format"
      via: "Direct function call"
      pattern: "std::format"
---

<objective>
Replace `swprintf_s` with `std::format` in EIDConfigurationWizard (non-LSASS code only)

Purpose: Type-safe string formatting eliminates buffer overflow risks and improves code readability. std::format is only safe in non-LSASS code where exceptions are allowed. EIDConfigurationWizard is an EXE that runs in user context, NOT in LSASS.

Output: std::format usage in EIDConfigurationWizard, #include <format> added
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-code-quality/04-RESEARCH.md
@EIDConfigurationWizard/CContainerHolder.cpp
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace swprintf_s with std::format in CContainerHolder.cpp</name>
  <files>EIDConfigurationWizard/CContainerHolder.cpp</files>
  <action>
1. Add `#include <format>` at the top after existing includes
2. Find line 62: `swprintf_s(szName, dwSize, L"Unknown Error");`
3. Replace with: `std::wstring errMsg = std::format(L"Unknown Error"); wcscpy_s(szName, dwSize, errMsg.c_str());`
4. NOTE: Keep wcscpy_s for buffer copy since szName is pre-allocated buffer

WHY std::format is safe here: EIDConfigurationWizard is an EXE that runs in user context, NOT in LSASS. Exceptions are allowed.

CRITICAL: DO NOT use std::format in LSASS components:
- EIDCardLibrary (LSASS) - MUST NOT use std::format
- EIDCredentialProvider (LSASS context) - MUST NOT use std::format
- EIDNativeLogon (LSASS) - MUST NOT use std::format
- EIDAuthenticationPackage (LSASS) - MUST NOT use std::format
- EIDPasswdChangeNotification (LSASS) - MUST NOT use std::format

Per research (04-RESEARCH.md), std::format can throw std::bad_alloc and crash LSASS.
  </action>
  <verify>grep -n "std::format" "C:/Users/user/Documents/EIDAuthentication/EIDConfigurationWizard/CContainerHolder.cpp"</verify>
  <done>EIDConfigurationWizard/CContainerHolder.cpp uses std::format for error message formatting</done>
</task>

<task type="auto">
  <name>Task 2: Verify no std::format in LSASS components</name>
  <files></files>
  <action>
1. Search for any `#include <format>` in LSASS components:
   - EIDCardLibrary/**/*.cpp
   - EIDAuthenticationPackage/**/*.cpp
   - EIDNativeLogon/**/*.cpp
   - EIDPasswordChangeNotification/**/*.cpp
   - EIDCredentialProvider/**/*.cpp
2. Verify NO std::format usage exists in these directories
3. If found, report as SECURITY ISSUE - std::format can throw std::bad_alloc and crash LSASS

Expected result: No <format> includes in LSASS components (current codebase state).
  </action>
  <verify>grep -r "include <format>" "C:/Users/user/Documents/EIDAuthentication/EIDCardLibrary" "C:/Users/user/Documents/EIDAuthentication/EIDAuthenticationPackage" "C:/Users/user/Documents/EIDAuthentication/EIDNativeLogon" "C:/Users/user/Documents/EIDAuthentication/EIDPasswordChangeNotification" "C:/Users/user/Documents/EIDAuthentication/EIDCredentialProvider" || echo "No format includes in LSASS code - GOOD"</verify>
  <done>Verified: No std::format usage in any LSASS component (EIDCardLibrary, EIDCredentialProvider, EIDAuthenticationPackage, EIDNativeLogon, EIDPasswordChangeNotification)</done>
</task>

</tasks>

<verification>
1. Verify EIDConfigurationWizard/CContainerHolder.cpp has `#include <format>`
2. Verify NO <format> includes exist in LSASS components (including EIDCredentialProvider)
3. Build EIDConfigurationWizard project - should compile with C++23
</verification>

<success_criteria>
1. std::format replaces swprintf_s in EIDConfigurationWizard (1 file)
2. All LSASS components remain free of std::format usage
3. EIDConfigurationWizard builds successfully
4. QUAL-01 requirement satisfied: std::format used in non-LSASS code only
</success_criteria>

<output>
After completion, create `.planning/phases/04-code-quality/04-01-SUMMARY.md`
</output>
