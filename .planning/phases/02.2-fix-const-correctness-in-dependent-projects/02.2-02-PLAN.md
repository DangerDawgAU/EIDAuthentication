---
phase: 02.2-fix-const-correctness-in-dependent-projects
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - EIDConfigurationWizard/DebugReport.cpp
  - EIDConfigurationWizard/EIDConfigurationWizardPage04.cpp
  - EIDConfigurationWizard/EIDConfigurationWizardPage05.cpp
autonomous: true
must_haves:
  truths:
    - "EIDConfigurationWizard project compiles without C2440 const-correctness errors"
    - "All string literal to PCHAR/PTSTR/LPWSTR conversions use static buffer pattern"
    - "Full solution builds successfully (no project blocking errors)"
  artifacts:
    - path: "EIDConfigurationWizard/DebugReport.cpp"
      provides: "Debug report functionality with const-correct string handling"
    - path: "EIDConfigurationWizard/EIDConfigurationWizardPage04.cpp"
      provides: "Wizard page 04 UI with const-correct list view initialization"
    - path: "EIDConfigurationWizard/EIDConfigurationWizardPage05.cpp"
      provides: "Wizard page 05 UI with const-correct password handling"
  key_links:
    - from: "EIDConfigurationWizard/DebugReport.cpp"
      to: "Windows API"
      via: "LSA_STRING, ExportOneTraceFile"
    - from: "EIDConfigurationWizard/EIDConfigurationWizardPage04.cpp"
      to: "ListView APIs"
      via: "LVCOLUMN.pszText"
    - from: "EIDConfigurationWizard/EIDConfigurationWizardPage05.cpp"
      to: "Tooltip API"
      via: "TOOLINFO.lpszText"
---

<objective>
Fix const-correctness errors in EIDConfigurationWizard project to enable C++23 compilation.

Purpose: C++23 with /Zc:strictStrings flag rejects implicit conversions from string literals (const char[]/const wchar_t[]) to non-const pointers (PCHAR/PTSTR/LPWSTR). EIDConfigurationWizard has ~5 such errors blocking the solution build.

Output: EIDConfigurationWizard compiles cleanly with C++23 flag.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Fix Pattern from Phase 2 (02-01a, 02-01b)
- Pattern 1: Change function parameter to const when function only reads string (preferred)
- Pattern 2: Use static arrays for Windows API compatibility when non-const required

# Known Errors in EIDConfigurationWizard
From build output analysis:
1. DebugReport.cpp line 40: PCHAR from string literal ("MYTEST" in LSA_STRING)
2. DebugReport.cpp line 353: PTSTR from string literal (L"c:\\Windows\\system32...")
3. EIDConfigurationWizardPage04.cpp line 25: PTSTR from string literal (TEXT("Comment"))
4. EIDConfigurationWizardPage05.cpp line 75: LPWSTR from string literal (L" " in TOOLINFO)

@.planning/phases/02-error-handling/02-01a-SUMMARY.md
@.planning/phases/02-error-handling/02-01b-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Fix const-correctness in DebugReport.cpp LSA_STRING initialization</name>
  <files>EIDConfigurationWizard/DebugReport.cpp</files>
  <action>
    Line 40 initializes an LSA_STRING structure with a string literal:
    ```cpp
    LSA_STRING Origin = { (USHORT)strlen("MYTEST"), (USHORT)sizeof("MYTEST"), "MYTEST" };
    ```

    The third member Buffer is PCHAR (char*), but "MYTEST" is const char[]. With C++23 /Zc:strictStrings, this is an error.

    Fix per Phase 2-01b pattern: Use static char array for string literal. At the top of the file (around line 28 after includes), add:
    ```cpp
    static char s_szMyTest[] = "MYTEST";
    ```
    Then change line 40 to:
    ```cpp
    LSA_STRING Origin = { (USHORT)strlen(s_szMyTest), (USHORT)sizeof(s_szMyTest), s_szMyTest };
    ```

    This provides a writable non-const array that can be assigned to PCHAR.
  </action>
  <verify>
    Build EIDConfigurationWizard project with Debug|x64 configuration and verify zero C2440 errors from DebugReport.cpp line 40
  </verify>
  <done>
    DebugReport.cpp line 40 const-correctness error resolved; static buffer used for LSA_STRING initialization
  </done>
</task>

<task type="auto">
  <name>Fix const-correctness in DebugReport.cpp line 353</name>
  <files>EIDConfigurationWizard/DebugReport.cpp</files>
  <action>
    Line 353 passes a string literal to a function expecting PTSTR:
    ```cpp
    ExportOneTraceFile(hInternalLogWriteHandle, L"c:\\Windows\\system32\\LogFiles\\WMI\\EIDCredentialProvider.etl");
    ```

    The second parameter expects PTSTR (wchar_t* non-const), but string literal is const wchar_t[].

    Fix per Phase 2-01b pattern: Use static wchar_t array for path. At the top of the file (around line 28 after includes, near the s_szMyTest addition), add:
    ```cpp
    static wchar_t s_wszEtlPath[] = L"c:\\Windows\\system32\\LogFiles\\WMI\\EIDCredentialProvider.etl";
    ```
    Then change line 353 to:
    ```cpp
    ExportOneTraceFile(hInternalLogWriteHandle, s_wszEtlPath);
    ```

    This provides a writable non-const array for PTSTR parameter.
  </action>
  <verify>
    Build EIDConfigurationWizard project with Debug|x64 configuration and verify zero C2440 errors from DebugReport.cpp line 353
  </verify>
  <done>
    DebugReport.cpp line 353 const-correctness error resolved; static buffer used for file path
  </done>
</task>

<task type="auto">
  <name>Fix const-correctness in EIDConfigurationWizardPage04.cpp line 25</name>
  <files>EIDConfigurationWizard/EIDConfigurationWizardPage04.cpp</files>
  <action>
    Line 25 initializes a PTSTR array with a string literal:
    ```cpp
    PTSTR Columns[] = {TEXT("Comment")};
    ```

    PTSTR is wchar_t* (non-const) in Unicode builds, but TEXT("Comment") produces const wchar_t[].

    Fix per Phase 2-01b pattern: Use static TCHAR array. At the top of the file (around line 22 after includes), add:
    ```cpp
    static TCHAR s_szColumnName[] = TEXT("Comment");
    ```
    Then change line 25 to:
    ```cpp
    PTSTR Columns[] = { s_szColumnName };
    ```

    This provides a writable non-const array for PTSTR initialization.
  </action>
  <verify>
    Build EIDConfigurationWizard project with Debug|x64 configuration and verify zero C2440 errors from EIDConfigurationWizardPage04.cpp line 25
  </verify>
  <done>
    EIDConfigurationWizardPage04.cpp line 25 const-correctness error resolved; static buffer used for column name
  </done>
</task>

<task type="auto">
  <name>Fix const-correctness in EIDConfigurationWizardPage05.cpp line 75</name>
  <files>EIDConfigurationWizard/EIDConfigurationWizardPage05.cpp</files>
  <action>
    Line 75 initializes a TOOLINFO structure with a string literal:
    ```cpp
    ti.lpszText = L" ";
    ```

    The lpszText member is LPTSTR (wchar_t* non-const), but L" " is const wchar_t[].

    Fix per Phase 2-01b pattern: Use static wchar_t array for space character. At the top of the file (around line 13 after includes), add:
    ```cpp
    static wchar_t s_wszSpace[] = L" ";
    ```
    Then change line 75 to:
    ```cpp
    ti.lpszText = s_wszSpace;
    ```

    This provides a writable non-const array for LPTSTR member.
  </action>
  <verify>
    Build EIDConfigurationWizard project with Debug|x64 configuration and verify zero C2440 errors from EIDConfigurationWizardPage05.cpp line 75
  </verify>
  <done>
    EIDConfigurationWizardPage05.cpp line 75 const-correctness error resolved; static buffer used for tooltip text
  </done>
</task>

<task type="auto">
  <name>Verify EIDConfigurationWizard builds successfully</name>
  <files>EIDConfigurationWizard/EIDConfigurationWizard.vcxproj</files>
  <action>
    Build the EIDConfigurationWizard project with both Debug and Release configurations to confirm all const-correctness errors are resolved.

    Run: msbuild EIDConfigurationWizard/EIDConfigurationWizard.vcxproj /p:Configuration=Debug /p:Platform=x64 /t:Rebuild
    Then: msbuild EIDConfigurationWizard/EIDConfigurationWizard.vcxproj /p:Configuration=Release /p:Platform=x64 /t:Rebuild

    Verify zero C2440 errors in build output. Any other errors should be noted but don't block this task (focus is const-correctness).
  </action>
  <verify>
    Build output shows zero C2440 errors for EIDConfigurationWizard project
  </verify>
  <done>
    EIDConfigurationWizard builds successfully with C++23 in both Debug and Release configurations
  </done>
</task>

</tasks>

<verification>
1. All four C2440 const-correctness errors in EIDConfigurationWizard are fixed
2. Project builds with C++23 flag without const-related errors
3. Static buffer pattern applied consistently with Phase 2 fixes
4. No regressions in existing functionality
</verification>

<success_criteria>
EIDConfigurationWizard project compiles cleanly with /std:c++23preview flag. All string literal to non-const pointer conversions use proper const-correct patterns (static arrays).
</success_criteria>

<output>
After completion, create `.planning/phases/02.2-fix-const-correctness-in-dependent-projects/02.2-02-SUMMARY.md`
</output>
