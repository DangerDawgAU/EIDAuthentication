---
phase: 02.2-fix-const-correctness-in-dependent-projects
plan: 02a
type: execute
wave: 1
depends_on: []
files_modified:
  - EIDConfigurationWizard/DebugReport.cpp
autonomous: true
must_haves:
  truths:
    - "DebugReport.cpp compiles without C2440 const-correctness errors"
    - "String literal to PCHAR/PTSTR conversions use static buffer pattern"
  artifacts:
    - path: "EIDConfigurationWizard/DebugReport.cpp"
      provides: "Debug report functionality with const-correct string handling"
  key_links:
    - from: "EIDConfigurationWizard/DebugReport.cpp"
      to: "Windows API"
      via: "LSA_STRING, ExportOneTraceFile"
---

<objective>
Fix const-correctness errors in DebugReport.cpp to enable C++23 compilation.

Purpose: C++23 with /Zc:strictStrings flag rejects implicit conversions from string literals (const char[]/const wchar_t[]) to non-const pointers (PCHAR/PTSTR). DebugReport.cpp has 2 such errors.

Output: DebugReport.cpp compiles cleanly with C++23 flag.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Fix Pattern from Phase 2 (02-01a, 02-01b)
- Pattern 1: Change function parameter to const when function only reads string (preferred)
- Pattern 2: Use static arrays for Windows API compatibility when non-const required

# Known Errors in DebugReport.cpp
From build output analysis:
1. DebugReport.cpp line 40: PCHAR from string literal ("MYTEST" in LSA_STRING)
2. DebugReport.cpp line 353: PTSTR from string literal (L"c:\\Windows\\system32...")

@.planning/phases/02-error-handling/02-01a-SUMMARY.md
@.planning/phases/02-error-handling/02-01b-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Fix const-correctness in DebugReport.cpp LSA_STRING initialization</name>
  <files>EIDConfigurationWizard/DebugReport.cpp</files>
  <action>
    Line 40 initializes an LSA_STRING structure with a string literal:
    ```cpp
    LSA_STRING Origin = { (USHORT)strlen("MYTEST"), (USHORT)sizeof("MYTEST"), "MYTEST" };
    ```

    The third member Buffer is PCHAR (char*), but "MYTEST" is const char[]. With C++23 /Zc:strictStrings, this is an error.

    Fix per Phase 2-01b pattern: Use static char array for string literal. At the top of the file (around line 28 after includes), add:
    ```cpp
    static char s_szMyTest[] = "MYTEST";
    ```
    Then change line 40 to:
    ```cpp
    LSA_STRING Origin = { (USHORT)strlen(s_szMyTest), (USHORT)sizeof(s_szMyTest), s_szMyTest };
    ```

    This provides a writable non-const array that can be assigned to PCHAR.
  </action>
  <verify>
    Build EIDConfigurationWizard project with Debug|x64 configuration and verify zero C2440 errors from DebugReport.cpp line 40
  </verify>
  <done>
    DebugReport.cpp line 40 const-correctness error resolved; static buffer used for LSA_STRING initialization
  </done>
</task>

<task type="auto">
  <name>Fix const-correctness in DebugReport.cpp line 353</name>
  <files>EIDConfigurationWizard/DebugReport.cpp</files>
  <action>
    Line 353 passes a string literal to a function expecting PTSTR:
    ```cpp
    ExportOneTraceFile(hInternalLogWriteHandle, L"c:\\Windows\\system32\\LogFiles\\WMI\\EIDCredentialProvider.etl");
    ```

    The second parameter expects PTSTR (wchar_t* non-const), but string literal is const wchar_t[].

    Fix per Phase 2-01b pattern: Use static wchar_t array for path. At the top of the file (around line 28 after includes, near the s_szMyTest addition), add:
    ```cpp
    static wchar_t s_wszEtlPath[] = L"c:\\Windows\\system32\\LogFiles\\WMI\\EIDCredentialProvider.etl";
    ```
    Then change line 353 to:
    ```cpp
    ExportOneTraceFile(hInternalLogWriteHandle, s_wszEtlPath);
    ```

    This provides a writable non-const array for PTSTR parameter.
  </action>
  <verify>
    Build EIDConfigurationWizard project with Debug|x64 configuration and verify zero C2440 errors from DebugReport.cpp line 353
  </verify>
  <done>
    DebugReport.cpp line 353 const-correctness error resolved; static buffer used for file path
  </done>
</task>

<task type="auto">
  <name>Verify DebugReport.cpp compiles successfully</name>
  <files>EIDConfigurationWizard/DebugReport.cpp</files>
  <action>
    Build the EIDConfigurationWizard project with Debug configuration to confirm both const-correctness errors in DebugReport.cpp are resolved.

    Run: msbuild EIDConfigurationWizard/EIDConfigurationWizard.vcxproj /p:Configuration=Debug /p:Platform=x64 /t:Rebuild /fl /flp:logfile=build.log

    Verify zero C2440 errors from DebugReport.cpp in build output. Any other errors should be noted but don't block this task (focus is const-correctness in DebugReport.cpp).
  </action>
  <verify>
    Build output shows zero C2440 errors from DebugReport.cpp
  </verify>
  <done>
    DebugReport.cpp compiles successfully with C++23; both const-correctness errors resolved
  </done>
</task>

</tasks>

<verification>
1. Both C2440 const-correctness errors in DebugReport.cpp are fixed
2. Static buffer pattern applied consistently with Phase 2 fixes
3. No regressions in existing functionality
</verification>

<success_criteria>
DebugReport.cpp compiles cleanly with /std:c++23preview flag. String literal to non-const pointer conversions use proper const-correct patterns (static arrays).
</success_criteria>

<output>
After completion, create `.planning/phases/02.2-fix-const-correctness-in-dependent-projects/02.2-02a-SUMMARY.md`
</output>
