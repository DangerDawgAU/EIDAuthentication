---
phase: 02.2-fix-const-correctness-in-dependent-projects
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - EIDCredentialProvider/common.h
  - EIDCredentialProvider/helpers.cpp
autonomous: true
must_haves:
  truths:
    - "EIDCredentialProvider project compiles without C2440 const-correctness errors"
    - "All string literal to LPWSTR/PWSTR conversions use static buffer pattern"
    - "Full solution builds successfully (no project blocking errors)"
  artifacts:
    - path: "EIDCredentialProvider/common.h"
      provides: "Credential provider field descriptors with const-correct string initialization"
    - path: "EIDCredentialProvider/helpers.cpp"
      provides: "Helper functions with const-correct string handling"
  key_links:
    - from: "EIDCredentialProvider/common.h"
      to: "credentialprovider.h"
      via: "CREDENTIAL_PROVIDER_FIELD_DESCRIPTOR.pszLabel"
---

<objective>
Fix const-correctness errors in EIDCredentialProvider project to enable C++23 compilation.

Purpose: C++23 with /Zc:strictStrings flag rejects implicit conversions from string literals (const wchar_t[]) to non-const pointers (LPWSTR/PWSTR). EIDCredentialProvider has ~13 such errors blocking the solution build.

Output: EIDCredentialProvider compiles cleanly with C++23 flag.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Fix Pattern from Phase 2 (02-01a, 02-01b)
- Pattern 1: Change function parameter to const when function only reads string (preferred)
- Pattern 2: Use static arrays for Windows API compatibility when non-const required

# Known Errors in EIDCredentialProvider
From build output analysis:
1. common.h lines 91-108: ~12 LPWSTR initializations from string literals (const wchar_t[] to LPWSTR)
2. helpers.cpp line 139: PWSTR from string literal (L"")

@.planning/phases/02-error-handling/02-01a-SUMMARY.md
@.planning/phases/02-error-handling/02-01b-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Fix const-correctness in common.h field descriptors</name>
  <files>EIDCredentialProvider/common.h</files>
  <action>
    The CREDENTIAL_PROVIDER_FIELD_DESCRIPTOR structures at lines 92-101 and 104-108 initialize pszLabel members with string literals (L""). With C++23 /Zc:strictStrings, these are const wchar_t[] but pszLabel is LPWSTR (non-const).

    Apply the fix pattern from Phase 2.1-01b: Remove the `const` qualifier from the `static const` array declarations. This allows the string literals to decay to non-const pointers during initialization.

    Change at the following lines:
    - Line 70: `static const FIELD_STATE_PAIR s_rgFieldStatePairs[]` → `static FIELD_STATE_PAIR s_rgFieldStatePairs[]`
    - Line 81: `static const FIELD_STATE_PAIR s_rgMessageFieldStatePairs[]` → `static FIELD_STATE_PAIR s_rgMessageFieldStatePairs[]`
    - Line 92: `static const CREDENTIAL_PROVIDER_FIELD_DESCRIPTOR s_rgCredProvFieldDescriptors[]` → `static CREDENTIAL_PROVIDER_FIELD_DESCRIPTOR s_rgCredProvFieldDescriptors[]`
    - Line 104: `static const CREDENTIAL_PROVIDER_FIELD_DESCRIPTOR s_rgMessageCredProvFieldDescriptors[]` → `static CREDENTIAL_PROVIDER_FIELD_DESCRIPTOR s_rgMessageCredProvFieldDescriptors[]`

    This matches the pattern used elsewhere in Windows code: making non-const static arrays allows string literal initialization.
  </action>
  <verify>
    Build EIDCredentialProvider project with Debug|x64 configuration and verify zero C2440 errors from common.h
  </verify>
  <done>
    All C2440 const-correctness errors in common.h are resolved; static arrays are properly initialized with string literals
  </done>
</task>

<task type="auto">
  <name>Fix const-correctness in helpers.cpp line 139</name>
  <files>EIDCredentialProvider/helpers.cpp</files>
  <action>
    Line 139 initializes a PWSTR variable with a string literal:
    ```cpp
    PWSTR pwzProtected = L"";
    ```

    With C++23 /Zc:strictStrings, L"" is const wchar_t[] but PWSTR is wchar_t* (non-const).

    Fix per Phase 2-01b pattern: Use static wchar_t array for the empty string. At the top of the file (around line 35 after includes), add:
    ```cpp
    static wchar_t s_wszEmpty[] = L"";
    ```
    Then change line 139 to:
    ```cpp
    PWSTR pwzProtected = s_wszEmpty;
    ```

    This provides a writable non-const array that can be assigned to PWSTR.
  </action>
  <verify>
    Build EIDCredentialProvider project with Debug|x64 configuration and verify zero C2440 errors from helpers.cpp line 139
  </verify>
  <done>
    helpers.cpp line 139 const-correctness error resolved; static buffer used for empty string literal
  </done>
</task>

<task type="auto">
  <name>Verify EIDCredentialProvider builds successfully</name>
  <files>EIDCredentialProvider/EIDCredentialProvider.vcxproj</files>
  <action>
    Build the EIDCredentialProvider project with both Debug and Release configurations to confirm all const-correctness errors are resolved.

    Run: msbuild EIDCredentialProvider/EIDCredentialProvider.vcxproj /p:Configuration=Debug /p:Platform=x64 /t:Rebuild
    Then: msbuild EIDCredentialProvider/EIDCredentialProvider.vcxproj /p:Configuration=Release /p:Platform=x64 /t:Rebuild

    Verify zero C2440 errors in build output. Any other errors should be noted but don't block this task (focus is const-correctness).
  </action>
  <verify>
    Build output shows zero C2440 errors for EIDCredentialProvider project
  </verify>
  <done>
    EIDCredentialProvider builds successfully with C++23 in both Debug and Release configurations
  </done>
</task>

</tasks>

<verification>
1. All three C2440 const-correctness errors in EIDCredentialProvider are fixed
2. Project builds with C++23 flag without const-related errors
3. Static buffer pattern applied consistently with Phase 2 fixes
4. No regressions in existing functionality
</verification>

<success_criteria>
EIDCredentialProvider project compiles cleanly with /std:c++23preview flag. All string literal to non-const pointer conversions use proper const-correct patterns (static arrays or const parameters).
</success_criteria>

<output>
After completion, create `.planning/phases/02.2-fix-const-correctness-in-dependent-projects/02.2-01-SUMMARY.md`
</output>
