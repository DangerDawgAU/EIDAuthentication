---
phase: 06-verification
plan: 02
type: execute
wave: 2
depends_on: [06-01]
files_modified: []
autonomous: false

user_setup:
  - service: "Windows 7/10/11 Test Systems"
    why: "LSA Authentication Package requires testing on actual Windows versions"
    manual_setup:
      - task: "Set up Windows 7 test VM or physical machine"
        required: true
      - task: "Set up Windows 10 test VM or physical machine"
        required: true
      - task: "Set up Windows 11 test VM or physical machine"
        required: true
      - task: "Install Visual Studio 2022 Remote Debugger on test VMs"
        required: false
      - task: "Enable Test Signing mode (bcdedit /set testsigning on)"
        required: true
      - task: "Disable LSA Protection (reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa /v RunAsPPL /t REG_DWORD /d 0)"
        required: true

must_haves:
  truths:
    - "LSA Authentication Package DLL loads successfully on Windows 7"
    - "LSA Authentication Package DLL loads successfully on Windows 10"
    - "LSA Authentication Package DLL loads successfully on Windows 11"
    - "LsaApInitializePackage completes without errors"
    - "LSA package registration persists across reboot"
  artifacts:
    - path: "C:\\Windows\\System32\\EIDAuthenticationPackage.dll"
      provides: "Installed LSA package binary"
    - path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Authentication Packages"
      provides: "LSA package registration"
      contains: "EIDAuthenticationPackage"
  key_links:
    - from: "installer registration"
      to: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Authentication Packages"
      via: "reg add or DllRegisterServer"
      pattern: "EIDAuthenticationPackage"
    - from: "LSASS"
      to: "EIDAuthenticationPackage.dll"
      via: "LsaLoadAuthenticationPackage at system boot"
      pattern: "LoadLibrary.*EIDAuthenticationPackage"
---

<objective>
Test LSA Authentication Package loading and initialization on Windows 7, 10, and 11.

Purpose: Verify the core authentication component (EIDAuthenticationPackage.dll) correctly loads into LSASS and initializes on all supported Windows versions. This is CRITICAL functionality - if LSA package fails to load, the entire authentication system is non-functional.

Output: Test results documenting LSA package load success/failure on each Windows version, with Event Viewer logs for diagnostics.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-build-system/01-03-SUMMARY.md
@.planning/phases/06-verification/06-01-SUMMARY.md

# LSA Authentication Package Architecture
From README.md:
- EIDAuthenticationPackage.dll is an LSA Authentication Package
- Exported functions: LsaApInitializePackage, LsaApLogonUserEx2, LsaApCallPackage, LsaApLogonTerminated, DllRegister/DllUnRegister
- Loads into LSASS process at system boot
- Registered in HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Authentication Packages
- CRITICAL: Requires static CRT (/MT) linkage verified in 06-01

# Windows 7 Considerations
- Uses v143 toolset for compatibility
- LSA behavior differs from Windows 10/11
- May have different security requirements

# Testing Requirements
- Three separate test machines or VMs (Win7, Win10, Win11)
- Administrator access for DLL registration
- Event Viewer access for log analysis
- Test Signing mode enabled for unsigned DLLs (development builds)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LSA package testing checklist</name>
  <files>.planning/phases/06-verification/06-02-LSA-TEST-CHECKLIST.md</files>
  <action>
Create a detailed testing checklist document for LSA Authentication Package testing. This document will guide the human tester through verification steps.

The checklist should include:

## Test Prerequisites
- [ ] Windows version verified (winver command)
- [ ] Administrator access confirmed
- [ ] Test Signing mode enabled (bcdedit /set testsigning on)
- [ ] LSA Protection disabled (reg add HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v RunAsPPL /t REG_DWORD /d 0)
- [ ] Build artifacts available from 06-01

## Installation Steps
1. Copy EIDAuthenticationPackage.dll to C:\Windows\System32\
2. Register LSA package via reg add or installer
3. Reboot system (required for LSA to load the package)
4. Verify registration in registry

## Verification Steps
1. Check Event Viewer -> Windows Logs -> System for LSA load events
2. Use Process Explorer to verify EIDAuthenticationPackage.dll loaded in lsass.exe
3. Check for LSA initialization errors in System log

## Per-Version Testing
Repeat full test on Windows 7, Windows 10, and Windows 11. Document results for each.

Create this checklist file as a markdown document.
  </action>
  <verify>File 06-02-LSA-TEST-CHECKLIST.md exists in phase directory with complete checklist content.</verify>
  <done>Detailed testing checklist created with all required steps for LSA package verification on Windows 7/10/11.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>LSA package testing checklist and build artifacts from plan 06-01</what-built>
  <how-to-verify>
Human tester required to perform the following on EACH Windows version (7, 10, 11):

## Prerequisite Setup (once per test machine)
1. Open Command Prompt as Administrator
2. Enable Test Signing: `bcdedit /set testsigning on`
3. Disable LSA Protection: `reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v RunAsPPL /t REG_DWORD /d 0 /f`
4. Reboot

## LSA Package Testing (repeat on Win7, Win10, Win11)

### Step 1: Installation
1. Copy EIDAuthenticationPackage.dll from build output (x64\Release\) to C:\Windows\System32\
2. Register LSA package:
   ```
   reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Authentication Packages" /v "EIDAuthenticationPackage" /t REG_MULTI_SZ /d "EIDAuthenticationPackage" /f
   ```
   OR run the installer if available

### Step 2: Reboot and Verify Load
1. Reboot the test system
2. After reboot, open Event Viewer (eventvwr.msc)
3. Navigate to Windows Logs -> System
4. Filter for LSA events: Click "Filter Current Log" and search for "LSA"
5. Look for successful package load events

### Step 3: Verify DLL Loaded in LSASS
1. Download Process Explorer from Microsoft Sysinternals (if not available)
2. Run Process Explorer as Administrator
3. Find lsass.exe process
4. View DLLs loaded in lsass.exe
5. Confirm EIDAuthenticationPackage.dll appears in the list

### Step 4: Check Event Viewer for Errors
1. In Event Viewer -> Windows Logs -> System
2. Look for Error events with source "LSA" or "Service Control Manager"
3. Note any error codes or messages

## Expected Results
- DLL appears in System32 directory
- Registry key contains EIDAuthenticationPackage
- EIDAuthenticationPackage.dll loaded in lsass.exe (Process Explorer)
- NO LSA load errors in Event Viewer

## Document Results
For each Windows version tested, report:
- [ ] DLL copied to System32 successfully
- [ ] Registry registration successful
- [ ] System rebooted successfully
- [ ] EIDAuthenticationPackage.dll found in lsass.exe modules (Yes/No)
- [ ] LSA errors in Event Viewer (list any)
- [ ] Overall test result (PASS/FAIL)

Provide the test results in your response. Use the format:
```
Windows 7: [PASS/FAIL] - [notes]
Windows 10: [PASS/FAIL] - [notes]
Windows 11: [PASS/FAIL] - [notes]
```
  </how-to-verify>
  <resume-signal>Provide test results for Windows 7, 10, and 11 LSA package loading. Type "PROCEED" when testing is complete or "BLOCKER" if critical issues found.</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document LSA package test results</name>
  <files>.planning/phases/06-verification/06-02-LSA-TEST-RESULTS.md</files>
  <action>
Based on the human tester's results from Task 2, create a comprehensive test results document.

Document should include:
- Test date and tester information
- Windows versions tested (with build numbers)
- Test results per version (PASS/FAIL)
- Event Viewer logs (if errors occurred)
- Process Explorer screenshots descriptions
- Any anomalies or issues discovered
- Blocker identification (if any version failed)
- Regression analysis (compare to pre-C++23 behavior if known)

If any version FAILED, document:
- Error codes from Event Viewer
- DLL load status
- Registry state
- Potential causes (CRT linkage, missing dependencies, API compatibility)

If all versions PASSED, document:
- Confirmation of C++23 compatibility across all Windows versions
- No regressions from C++23 modernization
- Ready for next testing phase (Credential Provider)
  </action>
  <verify>File 06-02-LSA-TEST-RESULTS.md exists with complete test documentation including all three Windows versions.</verify>
  <done>LSA package test results documented with pass/fail status for Windows 7, 10, and 11. Any blockers clearly identified.</done>
</task>

</tasks>

<verification>
Overall verification for 06-02 (LSA Package Testing):

1. **Test Checklist**: Complete checklist created with all verification steps
2. **Human Testing Results**: Tester reports results for Windows 7, 10, and 11
3. **Load Verification**: EIDAuthenticationPackage.dll confirmed loaded in lsass.exe
4. **Event Analysis**: No LSA errors in Event Viewer logs
5. **Documentation**: Test results document created with all findings

**Critical Success Criteria:**
- LSA package MUST load on all three Windows versions
- Any failure is a BLOCKER requiring investigation

**Potential Issues:**
- Static CRT linkage issues (should have been caught in 06-01)
- Windows 7 API incompatibilities with C++23 code
- Missing runtime dependencies
- LSA Protection blocking unsigned DLL
</verification>

<success_criteria>
1. Testing checklist document created
2. LSA package loads successfully on Windows 7, 10, and 11
3. Event Viewer shows no LSA load errors
4. Process Explorer confirms DLL loaded in lsass.exe
5. Test results document created with complete findings
6. No regressions from C++23 modernization

**If blockers found**: Document issue, create gap closure plan, do NOT proceed to 06-03
</success_criteria>

<output>
After completion, create `.planning/phases/06-verification/06-02-SUMMARY.md` with:
- Test results summary (PASS/FAIL per Windows version)
- Any issues discovered during testing
- Event Viewer error logs (if any)
- Screenshot references (Process Explorer, Event Viewer)
- Assessment of C++23 compatibility impact
- Blocker declaration if any version failed
</output>
