---
phase: 06-verification
plan: 04
type: execute
wave: 4
depends_on: [06-03]
files_modified: []
autonomous: false

user_setup:
  - service: "Configuration Wizard and Password Change Testing"
    why: "User-facing tools require interactive testing with GUI and smart card operations"
    manual_setup:
      - task: "Prepare test with enrolled smart card"
        required: true
      - task: "Ensure LSA package and Credential Provider are installed"
        required: true
      - task: "Have test passwords ready for change notification testing"
        required: true

must_haves:
  truths:
    - "Configuration Wizard launches without crashes"
    - "Configuration Wizard detects LSA package availability"
    - "Configuration Wizard smart card enrollment UI displays correctly"
    - "Password Change Notification DLL loads and processes password changes"
    - "Configuration Wizard elevation helper works for admin operations"
  artifacts:
    - path: "C:\\Program Files\\EID Authentication\\EIDConfigurationWizard.exe"
      provides: "Configuration Wizard GUI application"
    - path: "C:\\Program Files\\EID Authentication\\EIDConfigurationWizardElevated.exe"
      provides: "Elevated helper for admin operations"
    - path: "C:\\Windows\\System32\\EIDPasswordChangeNotification.dll"
      provides: "Password change notification DLL"
    - path: "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Notification Packages"
      provides: "Password filter registration"
      contains: "EIDPasswordChangeNotification"
  key_links:
    - from: "Configuration Wizard"
      to: "LSA package"
      via: "IPC LsaApCallPackage for credential management"
      pattern: "LsaApCallPackage"
    - from: "Password Change Notification"
      to: "LSA password change callback"
      via: "PasswordFilterNotify at password change"
      pattern: "PasswordChangeNotify"
---

<objective>
Test Configuration Wizard and Password Change Notification functionality.

Purpose: Verify the user-facing Configuration Wizard (EIDConfigurationWizard.exe) launches correctly, detects the LSA package, and provides a functional smart card enrollment interface. Also verify the Password Change Notification DLL (EIDPasswordChangeNotification.dll) correctly loads and processes password change events to keep smart card credentials synchronized.

Output: Test results documenting Configuration Wizard operation and Password Change Notification functionality on Windows 7, 10, and 11.
</objective>

<execution_context>
@C:/Users/user/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/user/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-build-system/01-03-SUMMARY.md
@.planning/phases/06-verification/06-01-SUMMARY.md
@.planning/phases/06-verification/06-02-SUMMARY.md
@.planning/phases/06-verification/06-03-SUMMARY.md

# Configuration Wizard Architecture
From README.md:
- EIDConfigurationWizard.exe - User-facing tool for smart card enrollment
- EIDConfigurationWizardElevated.exe - UAC elevation helper for admin tasks
- Communicates with LSA package via LsaApCallPackage for credential management
- IPC Message Types: CreateStoredCredential, RemoveStoredCredential, HasStoredCredential, GetStoredCredentialRid
- Uses std::format (C++23) for string formatting (non-LSASS, user-mode EXE)

# Password Change Notification Architecture
From README.md:
- EIDPasswordChangeNotification.dll - Password Filter DLL
- Registered in HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Notification Packages
- Loads into LSASS process
- Receives password change notifications via PasswordFilterNotify
- Synchronizes password changes with smart card credentials

# C++23 Code Quality Features Used
- std::format in Configuration Wizard (verified in Phase 4, plan 04-01)
- std::span for buffer handling (verified in Phase 4, plan 04-03)

# Dependency on Previous Plans
- 06-01: Build artifacts must exist
- 06-02: LSA package must be loaded (Configuration Wizard needs it)
- 06-03: Credential Provider must be registered (full authentication flow)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Configuration Wizard and Password Change testing checklist</name>
  <files>.planning/phases/06-verification/06-04-CONFIG-TEST-CHECKLIST.md</files>
  <action>
Create a detailed testing checklist document for Configuration Wizard and Password Change Notification testing. This document will guide the human tester through verification steps.

The checklist should include:

## Test Prerequisites
- [ ] LSA package installed and tested (from 06-02)
- [ ] Credential Provider installed (from 06-03)
- [ ] Test user account exists on system
- [ ] Smart card reader connected
- [ ] Test smart card available (enrolled or ready for enrollment)

## Configuration Wizard Installation
1. Copy files to C:\Program Files\EID Authentication\
2. Register Control Panel entry (if applicable)
3. Create desktop shortcut (if applicable)

## Configuration Wizard Testing Steps
### Step 1: Launch
1. Double-click EIDConfigurationWizard.exe
2. **Document:** Does wizard launch without crash? (Yes/No)
3. **Document:** Any error dialogs appear? (Yes/No - describe)

### Step 2: LSA Package Detection
1. Observe wizard startup screen
2. **Document:** Does wizard detect LSA package? (Yes/No)
3. Look for "Package Not Available" message

### Step 3: Smart Card Detection
1. Insert smart card
2. **Document:** Does wizard detect card? (Yes/No)
3. **Document:** Certificate information displays correctly? (Yes/No)

### Step 4: Enrollment UI
1. Navigate to enrollment screen
2. **Document:** UI renders correctly? (Yes/No - note any rendering issues)
3. Check for C++23 std::format related rendering issues (text formatting)

### Step 5: Elevation Helper
1. Trigger admin operation (if available)
2. **Document:** UAC prompt appears? (Yes/No)
3. **Document:** EIDConfigurationWizardElevated.exe runs? (Yes/No)

## Password Change Notification Testing Steps
### Step 1: Installation Verification
1. Verify DLL in System32: EIDPasswordChangeNotification.dll
2. Verify registry: HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Notification Packages contains "EIDPasswordChangeNotification"

### Step 2: Password Change Test
1. Log in as test user (with password)
2. Change password via Ctrl+Alt+Del -> Change a password
3. **Document:** Password change succeeds? (Yes/No)
4. Check Event Viewer for password filter errors

### Step 3: Event Viewer Verification
1. Open Event Viewer -> Windows Logs -> System
2. Filter for "password" or "notification" events
3. **Document:** Any errors related to EIDPasswordChangeNotification?

Create this checklist file as a markdown document.
  </action>
  <verify>File 06-04-CONFIG-TEST-CHECKLIST.md exists in phase directory with complete checklist content.</verify>
  <done>Detailed testing checklist created with all required steps for Configuration Wizard and Password Change testing.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Configuration Wizard and Password Change testing checklist, build artifacts from 06-01, and LSA package from 06-02</what-built>
  <how-to-verify>
Human tester required to perform the following on EACH Windows version (7, 10, 11):

## Prerequisite Setup (once per test machine)
1. Ensure LSA package is installed and working (from 06-02)
2. Ensure Credential Provider is installed (from 06-03)
3. Have test smart card ready

## Configuration Wizard Testing (repeat on Win7, Win10, Win11)

### Step 1: Installation
1. Create installation directory:
   ```
   mkdir "C:\Program Files\EID Authentication"
   ```
2. Copy files from x64\Release\:
   - EIDConfigurationWizard.exe
   - EIDConfigurationWizardElevated.exe
3. **Document:** Files copied successfully? (Yes/No)

### Step 2: Launch Configuration Wizard
1. Navigate to C:\Program Files\EID Authentication\
2. Double-click EIDConfigurationWizard.exe
3. **Document:** Wizard launches without crash? (Yes/No)
4. **Document:** Any error messages? (describe if yes)

### Step 3: LSA Package Detection
1. Observe wizard window
2. Look for status message about LSA package
3. **Document:** LSA package detected? (Yes/No)
4. **Document:** Any "Package Not Available" errors? (Yes/No)

### Step 4: Smart Card Detection
1. Insert smart card into reader
2. Wait 2-3 seconds
3. **Document:** Wizard detects smart card? (Yes/No)
4. If yes, **Document:** Certificate information displays? (Yes/No)

### Step 5: UI Rendering Check (C++23 Verification)
1. Navigate through wizard screens
2. Look for text formatting issues (garbled text, missing text, layout problems)
3. **Document:** Any rendering issues? (Yes/No - describe if yes)
4. Note: C++23 std::format should produce correctly formatted text

### Step 6: Elevation Helper Test (if applicable)
1. Try to perform admin operation in wizard
2. **Document:** UAC prompt appears? (Yes/No)
3. **Document:** Elevation works correctly? (Yes/No)

## Password Change Notification Testing (repeat on Win7, Win10, Win11)

### Step 1: Installation Verification
1. Verify DLL in System32:
   ```
   dir C:\Windows\System32\EIDPasswordChangeNotification.dll
   ```
2. **Document:** DLL exists? (Yes/No)
3. Verify registry:
   ```
   reg query "HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Notification Packages"
   ```
4. **Document:** "EIDPasswordChangeNotification" in list? (Yes/No)

### Step 2: Password Change Test
1. Log in to Windows with test user account (password-based)
2. Press Ctrl+Alt+Del
3. Select "Change a password"
4. Enter old password and new password
5. **Document:** Password change succeeds? (Yes/No)
6. **Document:** Any error messages? (describe if yes)

### Step 3: Event Viewer Check
1. Open Event Viewer (eventvwr.msc)
2. Navigate to Windows Logs -> System
3. Filter for "password" or filter by Error events
4. **Document:** Any EIDPasswordChangeNotification errors? (Yes/No - list if yes)

## Document Results
For each Windows version tested, report:

### Configuration Wizard
- [ ] Files copied successfully
- [ ] Wizard launches without crash (Yes/No)
- [ ] LSA package detected (Yes/No)
- [ ] Smart card detection working (Yes/No)
- [ ] UI rendering correct (Yes/No)
- [ ] Elevation helper working (Yes/No)
- [ ] Overall wizard result (PASS/FAIL)

### Password Change Notification
- [ ] DLL exists in System32 (Yes/No)
- [ ] Registry entry exists (Yes/No)
- [ ] Password change succeeds (Yes/No)
- [ ] Event Viewer errors (list any)
- [ ] Overall password change result (PASS/FAIL)

Provide the test results in your response. Use the format:
```
Windows 7: Config Wizard [PASS/FAIL] - Password Change [PASS/FAIL] - [notes]
Windows 10: Config Wizard [PASS/FAIL] - Password Change [PASS/FAIL] - [notes]
Windows 11: Config Wizard [PASS/FAIL] - Password Change [PASS/FAIL] - [notes]
```
  </how-to-verify>
  <resume-signal>Provide Configuration Wizard and Password Change test results for Windows 7, 10, and 11. Type "PROCEED" when testing is complete or "BLOCKER" if critical issues found.</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document Configuration Wizard and Password Change test results</name>
  <files>.planning/phases/06-verification/06-04-CONFIG-TEST-RESULTS.md</files>
  <action>
Based on the human tester's results from Task 2, create a comprehensive test results document.

Document should include:
- Test date and tester information
- Windows versions tested (with build numbers)

## Configuration Wizard Results
- Launch status per version
- LSA package detection status
- Smart card detection status
- UI rendering verification (C++23 std::format check)
- Elevation helper status
- Any crashes or errors

## Password Change Notification Results
- DLL installation status
- Registry registration status
- Password change operation status
- Event Viewer error logs

## Summary
- Overall results per version (PASS/FAIL)
- Any C++23-related issues (especially std::format rendering)
- Blocker identification (if any version failed)
- Regression analysis (compare to pre-C++23 behavior if known)

If any version FAILED, document:
- Error messages from crash dialogs
- Event Viewer error codes
- DLL dependencies (check with dumpbin if needed)
- Potential causes (C++23 runtime issues, missing dependencies)

If all versions PASSED, document:
- Confirmation of C++23 compatibility for user-mode applications
- std::format rendering works correctly
- No regressions from C++23 modernization
- Ready for final verification phase summary (06-05)
  </action>
  <verify>File 06-04-CONFIG-TEST-RESULTS.md exists with complete test documentation including all three Windows versions.</verify>
  <done>Configuration Wizard and Password Change test results documented. Any blockers clearly identified.</done>
</task>

</tasks>

<verification>
Overall verification for 06-04 (Configuration Wizard and Password Change Testing):

1. **Test Checklist**: Complete checklist created with all verification steps
2. **Human Testing Results**: Tester reports results for Windows 7, 10, and 11
3. **Configuration Wizard**: Launches without crashes, detects LSA package
4. **Smart Card Detection**: Card detection working in wizard
5. **UI Rendering**: No C++23 std::format related rendering issues
6. **Password Change**: Password filter loads and processes changes
7. **Event Analysis**: No errors in Event Viewer
8. **Documentation**: Test results document created with all findings

**Critical Success Criteria:**
- Configuration Wizard MUST launch without crashes
- LSA package detection MUST work
- Password Change Notification MUST load (registry entry exists)
- Password changes MUST succeed

**Acceptable:**
- Minor UI issues that don't prevent functionality
- Smart card enrollment not tested (if no enrolled card available)

**Potential Issues:**
- std::format rendering problems (C++23 specific)
- C++ runtime library issues (should have been caught in 06-01)
- LSA communication failures (IPC issues)
- Password filter blocking password changes
</verification>

<success_criteria>
1. Testing checklist document created
2. Configuration Wizard launches on all Windows versions
3. LSA package detection working
4. Smart card detection functional in wizard
5. Password Change Notification loads and processes changes
6. No C++23-related UI regressions
7. Test results document created with complete findings

**If blockers found**: Document issue, create gap closure plan, proceed to 06-05 for final summary
</success_criteria>

<output>
After completion, create `.planning/phases/06-verification/06-04-SUMMARY.md` with:
- Configuration Wizard test results summary (PASS/FAIL per Windows version)
- Password Change Notification test results summary
- UI rendering status (C++23 std::format verification)
- Any issues discovered during testing
- Event Viewer error logs (if any)
- Screenshot references (wizard screens, error dialogs)
- Assessment of C++23 compatibility impact on user-mode applications
- Blocker declaration if any version failed
</output>
